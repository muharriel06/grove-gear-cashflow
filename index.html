<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinancePro - Pencatat Keuangan Mandiri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --in: #10b981; --out: #ef4444; --bg: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); }
        .card-stat { border-radius: 15px; border: none; transition: 0.3s; }
        .bg-income { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .bg-expense { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .bg-balance { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .nav-pills .nav-link.active { background-color: #1e293b; }
        .btn-income { background-color: var(--in); color: white; }
        .btn-expense { background-color: var(--out); color: white; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark shadow-sm mb-4">
    <div class="container">
        <span class="navbar-brand fw-bold"><i class="fas fa-chart-line me-2 text-info"></i>FINANCE PRO</span>
        <button class="btn btn-outline-light btn-sm" onclick="resetApp()">Reset Data</button>
    </div>
</nav>

<div class="container pb-5">
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card card-stat bg-income p-3 shadow">
                <small class="opacity-75">Total Pemasukan</small>
                <h3 class="fw-bold mb-0" id="stat-income">Rp0</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-stat bg-expense p-3 shadow">
                <small class="opacity-75">Total Pengeluaran</small>
                <h3 class="fw-bold mb-0" id="stat-expense">Rp0</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-stat bg-balance p-3 shadow">
                <small class="opacity-75">Saldo Akhir</small>
                <h3 class="fw-bold mb-0" id="stat-balance">Rp0</h3>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card shadow-sm p-4">
                <h5 class="fw-bold mb-3">Tambah Transaksi</h5>
                <form id="finance-form">
                    <div class="mb-3">
                        <label class="small fw-bold">Keterangan</label>
                        <input type="text" id="desc" class="form-control" placeholder="Contoh: Gaji Karyawan" required>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Jumlah (Rp)</label>
                        <input type="number" id="amount" class="form-control" placeholder="0" required>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Jenis</label>
                        <select id="type" class="form-select" required>
                            <option value="income">Pemasukan (Uang Masuk)</option>
                            <option value="expense">Pengeluaran (Uang Keluar)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Tanggal</label>
                        <input type="date" id="date" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-dark w-100 fw-bold py-2">SIMPAN TRANSAKSI</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold text-secondary">Riwayat Transaksi Bulanan</h6>
                    <select id="filter-bulan" class="form-select form-select-sm w-auto" onchange="renderData()">
                        </select>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Tanggal</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="data-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    let financeDB = JSON.parse(localStorage.getItem('finance_db')) || [];

    // Set tanggal hari ini sebagai default di form
    document.getElementById('date').valueAsDate = new Date();

    document.getElementById('finance-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const desc = document.getElementById('desc').value;
        const amount = parseInt(document.getElementById('amount').value);
        const type = document.getElementById('type').value;
        const dateVal = new Date(document.getElementById('date').value);
        
        const newEntry = {
            id: Date.now(),
            desc,
            amount,
            type,
            date: dateVal.toLocaleDateString('id-ID'),
            monthYear: `${dateVal.getMonth() + 1}-${dateVal.getFullYear()}`
        };

        financeDB.unshift(newEntry);
        saveAndRefresh();
        this.reset();
        document.getElementById('date').valueAsDate = new Date();
    });

    function saveAndRefresh() {
        localStorage.setItem('finance_db', JSON.stringify(financeDB));
        isiFilterBulan();
        renderData();
    }

    function isiFilterBulan() {
        const filter = document.getElementById('filter-bulan');
        const months = [...new Set(financeDB.map(t => t.monthYear))];
        
        if (months.length === 0) {
            filter.innerHTML = '<option value="">- Belum ada data -</option>';
            return;
        }

        filter.innerHTML = months.map(m => {
            const [bln, thn] = m.split('-');
            const namaBulan = new Date(thn, bln-1).toLocaleString('id-ID', {month: 'long'});
            return `<option value="${m}">${namaBulan} ${thn}</option>`;
        }).join('');
    }

    function renderData() {
        const body = document.getElementById('data-body');
        const currentFilter = document.getElementById('filter-bulan').value;
        
        const filtered = financeDB.filter(t => t.monthYear === currentFilter);
        
        let totalInc = 0;
        let totalExp = 0;

        if (filtered.length === 0) {
            body.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-muted">Tidak ada transaksi di bulan ini</td></tr>';
        } else {
            body.innerHTML = filtered.map(t => {
                if(t.type === 'income') totalInc += t.amount;
                else totalExp += t.amount;

                return `<tr>
                    <td class="small">${t.date}</td>
                    <td class="fw-bold">${t.desc}</td>
                    <td class="${t.type === 'income' ? 'text-success' : 'text-danger'} fw-bold">
                        ${t.type === 'income' ? '+' : '-'} Rp${t.amount.toLocaleString()}
                    </td>
                    <td class="text-center">
                        <button class="btn btn-sm text-muted" onclick="deleteEntry(${t.id})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        // Update Stats
        document.getElementById('stat-income').innerText = 'Rp' + totalInc.toLocaleString();
        document.getElementById('stat-expense').innerText = 'Rp' + totalExp.toLocaleString();
        document.getElementById('stat-balance').innerText = 'Rp' + (totalInc - totalExp).toLocaleString();
    }

    function deleteEntry(id) {
        financeDB = financeDB.filter(t => t.id !== id);
        saveAndRefresh();
    }

    function resetApp() {
        if(confirm('Hapus semua data keuangan?')) {
            localStorage.removeItem('finance_db');
            financeDB = [];
            saveAndRefresh();
        }
    }

    // Jalankan saat pertama kali dibuka
    isiFilterBulan();
    renderData();
</script>
</body>
</html>